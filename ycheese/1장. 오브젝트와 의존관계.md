# 1장. 오브젝트와 의존관계
### 자바빈

간단히 빈이라고 부르기도 한다.
- 디폴트 생성자를 가질 것
- 프로퍼티를 가질 것

### 관심사의 분리

“변하는 것과 변하지 않는 것의 분리”
개발자가 **객체를 설계할 때** 가장 염두에 둬야 할 사항은 미래의 변화를 대비하는 것

**🤔 어떻게 대비할 것인가?**
- 변화의 폭을 최소한으로 줄인다.
- *분리와 확장*을 고려해 설계한다.
    - 모든 변경과 발전은 한 가지 관심사항에 집중해서 일어난다. (IoC)

### UserDao의 관심사

1. DB와 연결을 위한 커넥션 가져오기
2. 사용자 등록을 위해 DB에 보낼 SQL문을 담을 Statement를 만들고 실행하기
3. 작업이 끝나면 사용한 리소스를 시스템에 돌려주기

### 리팩토링

“기능이 바뀐 것은 없지만 코드가 더 깔끔해지고 미래의 변화에 대응할 수 있게 됐다 !”
- **메소드 추출**: 공통의 기능을 담당하는 메소드로 중복된 코드를 뽑아내는 것

### 디자인 패턴

“소프트웨어 설계 시 자주 만나는 문제를 해결하기 위한 재사용 가능한 솔루션”
- **템플릿 메소드 패턴**
    - 기능의 일부를 추상 메소드 등 오버라이딩이 가능한 형태로 만들고
    - 서브클래스에서 필요에 맞게 구현해서 사용하도록 하는 방법
- **팩토리 메소드 패턴**
    - 서브클래스에서 구체적인 오브젝트 생성 방법을 결정하게 하는 것
- **전략 패턴**
    - 클라이언트가 전략을 생성해 전략을 실행할 컨텍스트에 주입하는 패턴
    - 필요에 따라 변경이 필요한 알고리즘을 인터페이스를 통해 통째로 외부로 분리

### IoC

“프로그램 제어 흐름 구조가 뒤바뀌는 것”
오브젝트는 자신이 사용할 오브젝트를 스스로 선택하지 않는다.
`라이브러리`를 사용하는 코드는 애플리케이션 흐름을 직접 제어한다.
`프레임워크`는 프레임워크에 의해 코드가 사용된다.

→ 라이브러리와 프레임워크의 차이는 **제어의 역전**

### 스프링의 IoC

- 빈 팩토리
    - 스프링이 제어권을 갖고 직접 만들고 관계를 부여하는 오브젝트 == 빈
    - IoC가 적용됨
- 애플리케이션 컨텍스트
    - 빈 팩토리를 확장한 개념
    - 설정 정보를 담고 있는 걸 가져와서 활용하는 범용적인 IoC 엔진
    - IoC 컨테이너, 스프링 컨테이너, 빈 팩토리라고 부를 수 있다.

### 싱글톤

애플리케이션 컨텍스트에서 getBean()을 통해 빈을 호출하면 매번 같은 오브젝트가 호출됨
→ 애플리케이션 컨텍스트는 빈을 모두 싱글톤으로 만든다.

**왜 ?**

- 스프링이 적용되는 대상이 자바 엔터프라이즈 기술을 사용하는 서버 환경이기 때문
- 매 요청마다 새로운 오브젝트를 만들면 많은 요청이 들어올 때 서버에 부담을 준다.

**한계**

- private 생성자를 가지므로 상속 불가
- 테스트가 어려움
- 서버 환경에서는 싱글톤이 하나만 만들어지는 것을 보장할 수 없음
    - 여러 개의 JVM에 분산돼 설치가 되는 경우 각각의 JVM에서 독립적인 오브젝트가 생성되기 때문
- 전역 상태를 만들 수 있어 바람직하지 못함

### 싱글톤 레지스트리

스프링은 직접 싱글톤 형태의 오브젝트를 만들고 관리한다.
기존 싱글톤 패턴과는 다르게 자바 클래스를 통해 싱글톤을 활용하게 해준다.
싱글톤 패턴의 한계를 극복하고 스프링의 객체 지향 설계 원칙에 부합하게 해준다.
**싱글톤 오브젝트는 자바의 멀티스레드 환경에서 사용되므로 무상태로 만들어야 한다.**

### DI

“의존 오브젝트와 이를 사용할 주체 오브젝트를 런타임 시에 컨테이너 혹은 팩토리가 연결해주는 작업”
인터페이스를 통해 의존 관계를 설정해두면 구현체에 변화가 생겨도 의존 관계는 수정하지 않아도 된다.
→ 결합도가 낮아진다 !

### 결론

**변화에 대응**하기 위해 클래스에서 **관심사를 분리**한다.
클래스 간 관계가 필요하다면 느슨한 관계를 위해 인터페이스를 통해 관계를 설정한다.
런타임 환경에서 오브젝트를 통해 관계를 맺게 한다.
관계 설정은 IoC를 통한 DI를 이용한다.
